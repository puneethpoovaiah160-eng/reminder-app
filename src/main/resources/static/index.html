<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Emay Reminders</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 24px auto; }
    form { background:#f7f7f7;padding:16px;border-radius:6px;margin-bottom:16px }
    label { display:block;margin-top:8px }
    input, textarea { width:100%; padding:8px; box-sizing:border-box }
    .columns { display:flex; gap:16px }
    .col { flex:1 }
    .box { background:#fff;padding:12px;border-radius:6px;border:1px solid #eee }
    button { margin-top:8px;padding:8px 12px }
    .reminder { border-bottom:1px solid #eee;padding:8px 0 }
    .small { color:#666;font-size:0.9em }
  </style>
</head>
<body>
  <h1>Emay Reminders</h1>

  <form id="reminderForm">
    <label>Title<input type="text" id="title" required></label>
    <label>Description<textarea id="description"></textarea></label>
    <label>Reminder Time<input type="datetime-local" id="reminderTime" required></label>
    <button type="submit">Create Reminder</button>
  </form>

  <div class="columns">
    <div class="col">
      <h2>Upcoming</h2>
      <div id="upcoming" class="box"></div>
    </div>
    <div class="col">
      <h2>History</h2>
      <div id="history" class="box"></div>
    </div>
  </div>

  <script>
    async function loadLists(){
      const up = await fetch('/api/reminders/upcoming').then(r=>r.json());
      const hist = await fetch('/api/reminders/history').then(r=>r.json());

      const upEl = document.getElementById('upcoming');
      upEl.innerHTML = up.length ? up.map(r=>`<div class="reminder"><strong>${r.title}</strong><div class="small">${r.reminderTime}</div><div>${r.description||''}</div></div>`).join('') : '<div class="small">No upcoming reminders</div>';

      const histEl = document.getElementById('history');
      histEl.innerHTML = hist.length ? hist.map(r=>`<div class="reminder"><strong>${r.title}</strong><div class="small">${r.reminderTime} â€¢ completed ${r.completedAt||''}</div><div>${r.description||''}</div></div>`).join('') : '<div class="small">No history</div>';
    }

    document.getElementById('reminderForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;
      const reminderTime = document.getElementById('reminderTime').value; // format: yyyy-MM-ddTHH:mm

      const payload = { title, description, reminderTime };

      await fetch('/api/reminders', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });

      document.getElementById('title').value='';
      document.getElementById('description').value='';
      document.getElementById('reminderTime').value='';
      setTimeout(loadLists, 300);
    });

    loadLists();
    setInterval(loadLists, 30000);
  </script>
</body>
</html>
